<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Texel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        /* ===== Texel theme colors (tweak freely) ===== */
        --tx-bg: #f7faf9;           /* app background */
        --tx-paper: #ffffff;        /* cards/sections */
        --tx-border: #d5e1dd;       /* subtle borders */
        --tx-muted: #6b7d77;        /* secondary text */
        --tx-primary: #0d9488;      /* teal (brand) */
        --tx-primary-strong: #0b7b73; /* hover */
        --tx-accent: #14b8a6;      /* light accent */
        --tx-drop-bg: #f1fbf9;     /* dropzone bg */
        --tx-danger: #ef4444;      /* warnings */
      }

      html, body { height: 100%; }

      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic UI", "Meiryo", sans-serif;
        margin: 0;
        padding: 12px;
        background: var(--tx-bg);
        color: #111;
      }

      section {
        border-top: 2px solid var(--tx-border);
        margin-top: 24px;
        padding: 20px;
        background-color: var(--tx-paper);
        position: relative;
        border-radius: 10px;
        box-shadow: 0 0 0 1px rgba(0,0,0,0.02), 0 2px 10px rgba(0,0,0,0.04);
      }

      .disabled { opacity: 0.45; pointer-events: none; }

      h2 { margin-top: 0; }

      .drop-zone {
        border: 2px dashed var(--tx-border);
        padding: 20px;
        background: var(--tx-drop-bg);
        text-align: center;
        color: var(--tx-muted);
        position: relative;
        margin-bottom: 8px;
        border-radius: 10px;
      }

      .drop-zone.highlight {
        background-color: #dff7f3;
        border-color: var(--tx-primary);
        color: var(--tx-primary);
      }

      .drop-zone img {
        max-width: 100%;
        height: auto;
        display: block;
        margin-top: 10px;
      }

      .analysis-area {
        background: var(--tx-paper);
        padding: 10px;
        margin-top: 8px;
        border: 1px solid var(--tx-border);
        text-align: left;
        color: #000;
        border-radius: 8px;
      }

      .analysis-area textarea {
        width: 100%;
        height: 100px;
        font-size: 13px;
        font-family: inherit;
      }

      .toggle-button { font-size: 13px; color: #34423e; cursor: pointer; margin: 6px 0; }

      /* Spinner (hidden by default) */
      .spinner {
        display: none;
        border: 4px solid #eef4f2;
        border-top: 4px solid var(--tx-primary);
        border-radius: 50%;
        width: 20px; height: 20px;
        animation: spin 1s linear infinite;
        margin: 8px auto;
      }
      @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

      button {
        padding: 10px 18px;
        font-size: 14px;
        background-color: var(--tx-primary);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin: 10px auto;
        display: block;
        box-shadow: 0 1px 0 rgba(0,0,0,0.06);
      }
      button:disabled { background-color: #cbd5d1; cursor: not-allowed; }
      button.pressable { transition: transform 0.1s ease; }
      button.pressable:active { transform: translateY(2px); box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }

      .copy-button {
        font-size: 11px;
        padding: 6px 10px;
        background-color: #edf8f6;
        border: 1px solid var(--tx-border);
        border-radius: 6px;
        cursor: pointer;
        margin-top: 4px;
        color: #0f172a;
      }
      .copy-button:hover { background-color: #e4f6f2; }
      .copy-button:active { transform: translateY(2px); box-shadow: none; }

      .prompt-config-link {
        position: absolute; top: 12px; right: 12px;
        font-size: 16px; text-decoration: none; color: #8aa69f; cursor: pointer;
      }
      .prompt-config-link:hover { color: var(--tx-primary); }

      .tool-button {
        padding: 6px 12px;
        background-color: var(--tx-primary);
        color: white; border: none; border-radius: 6px; font-size: 13px; cursor: pointer;
        transition: background-color 0.2s ease;
      }
      .tool-button:hover { background-color: var(--tx-primary-strong); }
      .tool-button:disabled { background-color: #cbd5d1; cursor: not-allowed; }

      .modal-input {
        width: 90%; max-width: 260px; box-sizing: border-box; padding: 8px; margin: 12px auto; display: block; font-size: 14px;
        border: 1px solid var(--tx-border); border-radius: 6px;
      }

      /* suggestionå†…å€‹åˆ¥ã‚¨ãƒªã‚¢ã«ã‚‚å³ä¸Šæ­¯è»ŠãŒã†ã¾ãé…ç½®ã•ã‚Œã‚‹ã‚ˆã†ã«å¾®èª¿æ•´ */
      .analysis-area .prompt-config-link { position: absolute; top: 8px; right: 8px; }

      #code-banner {
        position: sticky; top: 0; left: 0; width: 100%; border-radius: 8px; text-align: center;
        background: var(--tx-primary); color: #fff; font-weight: 700; padding: 6px 12px;
        box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; z-index: 1000;
      }

      #northVectorSelect.warning { border: 2px solid var(--tx-danger); animation: blink 1s ease-in-out infinite; }
      .glow { animation: glow-border 1s infinite alternate; }
      @keyframes glow-border { from { box-shadow: 0 0 4px 2px rgba(20, 184, 166, 0.35); } to { box-shadow: 0 0 8px 4px rgba(20, 184, 166, 0.6); } }

      textarea.auto-grow { overflow: hidden; resize: none; min-height: 120px; line-height: 1.4em; }
      .flash { animation: flash-bg 0.8s ease-out; }
      @keyframes flash-bg { 0% { background: rgba(20, 184, 166, .15); } 100% { background: transparent; } }
    </style>
  </head>
  <body>
    <div id="code-banner">Texel</div>

    <!-- CL/BK å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆMV3ï¼šã‚¤ãƒ³ãƒ©ã‚¤ãƒ³JSãªã—ï¼‰ -->
    <div id="property-code-modal" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:9999;">
      <div style="background:#fff; padding:20px; border-radius:10px; width:320px; text-align:center; box-shadow: 0 10px 30px rgba(0,0,0,.15);">
        <h3 id="modal-title" style="margin:0 0 8px;">CL IDã¨BK IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h3>

        <!-- æ–°: CL / BK å…¥åŠ› -->
        <input type="text" id="cl-id-input" placeholder="B001 / R999 / S001 / M001" class="modal-input" />
        <input type="text" id="bk-id-input" placeholder="FXXXXXXXï¼ˆä¾‹ï¼šF1234567ï¼‰" class="modal-input" />

        <!-- äº’æ›: æ—¢å­˜JSãŒå‚ç…§ã™ã‚‹æ—§IDã¸å€¤ãƒŸãƒ©ãƒ¼ï¼ˆhiddenï¼‰ -->
        <input type="hidden" id="property-code-input" />
        <input type="hidden" id="spreadsheet-id-input" />

        <button id="property-code-submit" disabled style="padding:8px 16px; background:var(--tx-primary); color:#fff; border:none; border-radius:8px;">æ±ºå®š</button>
        <p id="modal-error" style="color:#ef4444; font-size:12px; margin:6px 0 0; display:none;"></p>
      </div>
    </div>

    <!-- PDF æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="pdf-section" class="disabled">
      <h2>
        ğŸ“ PDFã‹ã‚‰ç‰©ä»¶æƒ…å ±ã‚’æŠ½å‡º
        <!-- Texelå°‚ç”¨ã‚­ãƒ¼ï¼ˆâ€»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚«ã‚¿ãƒ­ã‚°ç”¨ãƒªãƒ³ã‚¯ã¯ä½œã‚Šã¾ã›ã‚“ï¼‰ -->
        <a href="#" class="prompt-config-link" data-type="texel-pdf-image" title="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†">âš™</a>
      </h2>
      <div id="pdf-drop" class="drop-zone">ã“ã“ã«PDFã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</div>
      <input type="file" id="pdf-file" accept=".pdf" />
      <img id="pdf-image-preview" style="display: none; width: 100%; max-height: 240px; object-fit: contain; margin-top: 8px;" />
      <div class="toggle-button" id="pdf-toggle">â–¶ æŠ½å‡ºçµæœã‚’è¡¨ç¤º</div>
      <div id="pdf-analysis" class="analysis-area" style="display: none;">
        <div id="pdf-preview" style="white-space: pre-wrap;"></div>
      </div>
      <div id="loadingSpinner-pdf" class="spinner" style="display: none; margin-top: 8px;"></div>
    </section>

    <section id="propertyinfo-section" class="disabled">
      <h2>ğŸ§  AIå‚ç…§ç”¨ç‰©ä»¶ãƒ¡ãƒ¢</h2>
      <textarea id="property-info" placeholder="ä¾‹ï¼šé§…å¾’æ­©3åˆ†ã®å—å‘ãã€‚çœºæœ›è‰¯å¥½ã§æ—¥å½“ãŸã‚ŠæŠœç¾¤ã€‚ãƒ¢ãƒ‡ãƒ«ãƒ«ãƒ¼ãƒ å…¬é–‹ä¸­ãªã©..." rows="5" style="width:100%; font-size:13px;"></textarea>
    </section>

    <!-- é–“å–å›³ æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="floorplan-section" class="disabled">
      <h2>
        ğŸ“ é–“å–å›³ã‚’åˆ†æ
        <!-- Texelå°‚ç”¨ã‚­ãƒ¼ -->
        <a href="#" class="prompt-config-link" data-type="texel-floorplan" title="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†">âš™</a>
      </h2>
      <div id="floorplan-drop" class="drop-zone">ã“ã“ã«é–“å–å›³ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</div>
      <input type="file" id="floorplan-file" accept="image/*" />
      <img id="floorplan-preview" style="display: none; width: 100%; max-height: 240px; object-fit: contain; margin-top: 8px;" />

      <div id="north-vector-dropdown" style="display: none; border: 2px solid var(--tx-danger); border-radius: 10px; margin: 8px 0; padding: 8px;">
        <label for="northVectorSelect" style="font-size: 13px;">åŒ—ã®æ–¹å‘ï¼š</label>
        <select id="northVectorSelect" style="font-size: 13px;">
          <option value="">-- é¸æŠ --</option>
          <option value="up">â†‘ ä¸Šï¼ˆupï¼‰</option>
          <option value="upright">â†— å³ä¸Šï¼ˆuprightï¼‰</option>
          <option value="right">â†’ å³ï¼ˆrightï¼‰</option>
          <option value="downright">â†˜ å³ä¸‹ï¼ˆdownrightï¼‰</option>
          <option value="down">â†“ ä¸‹ï¼ˆdownï¼‰</option>
          <option value="downleft">â†™ å·¦ä¸‹ï¼ˆdownleftï¼‰</option>
          <option value="left">â† å·¦ï¼ˆleftï¼‰</option>
          <option value="upleft">â†– å·¦ä¸Šï¼ˆupleftï¼‰</option>
        </select>
        <div style="text-align: center; margin-top: 8px;">
          <button id="confirmNorthButton" class="copy-button">åˆ†æé–‹å§‹</button>
        </div>
      </div>

      <div class="toggle-button" id="floorplan-toggle">â–¶ åˆ†æçµæœã‚’è¡¨ç¤º</div>
      <div id="floorplan-analysis" class="analysis-area">
        <textarea id="floorplan-preview-text" style="width:100%;min-height:120px;font-size:13px;resize:none;"></textarea>
      </div>
      <div id="loadingSpinner-floorplan" class="spinner" style="display: none; margin-top: 8px;"></div>
    </section>

    <section id="suggestion-section" class="disabled">
      <h2>
        âœ¨ ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆç”Ÿæˆ
        <!-- Texelå°‚ç”¨ã‚­ãƒ¼ -->
        <a href="#" class="prompt-config-link" data-type="texel-suggestion" title="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†">âš™</a>
      </h2>
      <button id="generate-suggestions" class="pressable" disabled>ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆã‚’ç”Ÿæˆ</button>
      <div id="suggestion-area" class="analysis-area" style="margin-top: 8px;">
        <textarea id="editable-suggestion" style="width:100%; height:20px; font-size:13px;"></textarea>
      </div>
      <div id="suggestion-controls" style="margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
        <label style="font-size: 13px;">æ–‡å­—æ•°:</label>
        <input type="number" id="summary-length" value="500" min="100" max="1000" style="width: 50px; padding: 4px;" /> æ–‡å­—
        <label style="font-size: 13px;">å‡ºåŠ›:</label>
        <select id="summary-format" style="padding: 4px;">
          <option value="summary">è¦ç´„</option>
          <option value="bullet">ç®‡æ¡æ›¸ã</option>
        </select>
        <button id="generate-summary" class="copy-button">âœ¨ ã“ã®å†…å®¹ã§å†ç”Ÿæˆ</button>
        <button id="reset-suggestion" class="copy-button">â†© å…ƒã«æˆ»ã™</button>
      </div>
      <div id="suggestion-tool-row" style="margin-top:4px; display:flex; justify-content:flex-end; gap:8px; align-items:center;">
        <button id="copy-suggestion" class="copy-button">ğŸ“‹ ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
        <span id="suggestion-count" style="font-size:12px; color:#555;">0</span>
      </div>
      <div id="loadingSpinner-suggestion" class="spinner" style="display: none; margin-top: 8px;"></div>

      <!-- ãƒãƒ¼ã‚¿ãƒ«ç”¨ã‚­ãƒ£ãƒƒãƒãƒ»ã‚³ãƒ¡ãƒ³ãƒˆ -->
      <div style="margin-top: 16px;">
        <div class="analysis-area" style="position: relative; margin-top: 16px;">
          <a href="#" class="prompt-config-link" data-type="texel-suumo-catch" title="SUUMOã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†" style="top: 8px; right: 8px;">âš™</a>
          <label style="font-size: 13px;">ğŸ·ï¸ SUUMOã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ï¼ˆ37æ–‡å­—ï¼‰</label>
          <textarea id="suumo-catch" maxlength="37" placeholder="ä¾‹ï¼šå—å‘ããƒ»è§’éƒ¨å±‹ï¼é§…å¾’æ­©3åˆ†ã§ç”Ÿæ´»ä¾¿åˆ©" style="width:100%; height:40px; font-size:13px;"></textarea>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
            <button class="copy-button" id="copy-suumo-catch">ğŸ“‹ SUUMOã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼</button>
            <span id="suumo-catch-count" style="font-size: 12px; color: #555;">0</span>
          </div>
        </div>
        <div class="analysis-area" style="position: relative; margin-top: 16px;">
          <a href="#" class="prompt-config-link" data-type="texel-suumo-comment" title="SUUMOãƒãƒƒãƒˆç”¨ã‚³ãƒ¡ãƒ³ãƒˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†" style="top: 8px; right: 8px;">âš™</a>
          <label style="font-size: 13px;">ğŸ’¬ SUUMOãƒãƒƒãƒˆç”¨ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ300æ–‡å­—ï¼‰</label>
          <textarea id="suumo-comment" maxlength="300" placeholder="ä¾‹ï¼šé€šå‹¤ãƒ»é€šå­¦ã«ä¾¿åˆ©ãªé§…è¿‘ç‰©ä»¶..." style="width:100%; height:40px; font-size:13px;"></textarea>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
            <button class="copy-button" id="copy-suumo-comment">ğŸ“‹ SUUMOãƒãƒƒãƒˆç”¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
            <span id="suumo-comment-count" style="font-size: 12px; color: #555;">0</span>
          </div>
        </div>
        <div class="analysis-area" style="position: relative; margin-top: 16px;">
          <a href="#" class="prompt-config-link" data-type="texel-athome-comment" title="ã‚¹ã‚¿ãƒƒãƒ•ã‚³ãƒ¡ãƒ³ãƒˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†" style="top: 8px; right: 8px;">âš™</a>
          <label style="font-size: 13px;">ğŸ  ã‚¹ã‚¿ãƒƒãƒ•ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ100æ–‡å­—ï¼‰</label>
          <textarea id="athome-comment" maxlength="100" placeholder="ä¾‹ï¼šæ—¥å½“ãŸã‚Šè‰¯å¥½ãª2LDKã€åç´ã‚‚è±Šå¯Œã€‚" style="width:100%; height:40px; font-size:13px;"></textarea>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
            <button class="copy-button" id="copy-athome-comment">ğŸ“‹ ã‚¹ã‚¿ãƒƒãƒ•ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
            <span id="athome-comment-count" style="font-size: 12px; color: #555;">0</span>
          </div>
        </div>
        <div class="analysis-area" style="position: relative; margin-top: 16px;">
          <a href="#" class="prompt-config-link" data-type="texel-athome-appeal" title="athomeã‚¨ãƒ³ãƒ‰å‘ã‘ã‚¢ãƒ”ãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†" style="top: 8px; right: 8px;">âš™</a>
          <label style="font-size: 13px;">ğŸ‘ª athomeã‚¨ãƒ³ãƒ‰å‘ã‘ã‚¢ãƒ”ãƒ¼ãƒ«ï¼ˆ500æ–‡å­—ï¼‰</label>
          <textarea id="athome-appeal" maxlength="500" placeholder="ä¾‹ï¼šå®¶æ—ã¿ã‚“ãªãŒå¿«é©ã«æš®ã‚‰ã›ã‚‹é–“å–ã‚Š..." style="width:100%; height:40px; font-size:13px;"></textarea>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
            <button class="copy-button" id="copy-athome-appeal">ğŸ“‹ athomeã‚¨ãƒ³ãƒ‰å‘ã‘ã‚¢ãƒ”ãƒ¼ãƒ«ã‚’ã‚³ãƒ”ãƒ¼</button>
            <span id="athome-appeal-count" style="font-size: 12px; color: #555;">0</span>
          </div>
        </div>
      </div>
    </section>

    <!-- éƒ¨å±‹å†™çœŸ æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="room-section" class="disabled">
      <h2>
        ğŸ–¼ï¸ ç”»åƒã‚’åˆ†æ
        <!-- Texelå°‚ç”¨ã‚­ãƒ¼ -->
        <a href="#" class="prompt-config-link" data-type="texel-roomphoto" title="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†">âš™</a>
      </h2>
      <div id="room-drop" class="drop-zone">ã“ã“ã«éƒ¨å±‹å†™çœŸã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</div>
      <input type="file" id="room-file" accept="image/*" />
      <img id="room-preview" style="display: none; width: 100%; max-height: 240px; object-fit: contain; margin-top: 8px;" />
      <div id="analysis-result" class="analysis-area" style="display: none;"></div>
      <div id="loadingSpinner-room" class="spinner" style="display: none; margin-top: 8px;"></div>
    </section>

    <section id="history-section" class="disabled">
      <h2>ğŸ“ åˆ†æå±¥æ­´</h2>
      <div id="history-container"></div>
    </section>

    <div id="loadingSpinner" class="spinner" style="display: none;"></div>

    <script type="module" src="texel.js"></script>

    <!-- ç”»åƒãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ç”¨ -->
    <div id="image-popup-overlay" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:10000;justify-content:center;align-items:center;">
      <img id="image-popup" src="" style="max-width:90%;max-height:90%;box-shadow:0 0 12px #000;border-radius:8px;" />
    </div>
  </body>
</html>
